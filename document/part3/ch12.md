# デザインパターン
## ドメインパターンとデザインパターン
* ドメインの課題を解決するためのもの　＜＝＞　技術的な課題を解決するためのもの
* デザインパターンの中にはドメインパターンとして使用できるものがある
デザインパターンがドメインにたいしてどのように適用できるかをみていく

## ストラテジー
ドメインにおけるストラテジーパターンは、技術的なアルゴリズムのファミリーを交換可能にする
にとどまらず、ビジネスルールを相互交換可能にする
* 技術的な観点はアルゴリズムの置き換える能力
* ドメイン的な観点はポリシーやルールを表現する

ドメインを明確にし、用意にテストができるようになる

``` java
// 注目すべきは抽象度
// 大体はソートアルゴリズムの感想とか、FWでの処理の分岐とかで使われるイメージだが、、、
// 不動産審査ドメインを考える

// 審査ルールを表現
interface 審査{
    boolean 審査する(収入);
}

class 審査_自営業 implements 審査{
    boolean 審査する(収入){
        return 収入＞１０００万
    }
}

class 審査_士業 implements 審査｛
    boolean 審査する(収入)｛
    return 収入＞５００万
｝

// client
main(){
    審査　= create審査（買う人）;
    if(審査.審査する(買う人.収入)) {
        throw new 金ないException
    }
    // 合格
}
```

---

## コンポジット
オブジェクトを組み立てて部分と全体を表すツリーを作ること。コンポジットパターンを使うことで、個々と複合体を一様に扱える

```java
// ファイルシステム
// クライアントからしたら、ディレクトリとファイルを区別せず使うことができる
// 書簡としたら、これを業務で適用するのなかなかむずそう

interface Entry{
    String name;
    void remove();
}

class Directory implements Entry{
    List<Entry> entries;
    String name;
    void remove(){ 
    }
}

class File implements Entry{
    String name;
    void remove(){ 
    }
}

```
議論してみたいこと
上の２パターンで他のパターンの業務のモデリングができるか
他のパターンではどうか？？？

---
## ドメインイベント
### なにか
* ドメインエキスパートがきにかけるなにかの出来事

### イベントの種類
* 集約に対する操作
  * 色々TODO

* クライアントからの直接のリクエストから出来上がるもの
  * 図書館の貸し借りはこのタイプ
  * 集約としてモデリング
  * 削除は許さない（基本）
  * おすすめは一意なIDを生成して割り当てる
  * パブリックするタイミングはリポジトリへの登録時

### A+ES 

#### 新たな概念
* イベントストア

* メリット
  * 履歴がうしなわれないため、BI、監査、デバック、再現性
  * 追記のみのためパフォーマンスがよくなる
  * 変更に強くなる、振る舞いに注力できる、インピーダンスミスマッチを回避...正直良くわからない
  * 永続化のシンプルさ＋多用途に使える、、集約の変更につよい

* デメリット
  * 業務ドメインに対する深い知識が必要（別に他の手法でもいるのでは？？？）
  * ツールがそろっていない、知識体系もでそろっていない、経験の浅いチームが使うとリスクが大きい
  * CQRSが必要になる、イベントストリームに対するクエリは難しいから、学習曲線は高くなる


### 今日やること
* クラウドフォーメーションを完成させる
* サーバーレスの勉強

### きづき
* レンディングレコードは集約ではない、貸し出し表はかろうじて集約とおもう
  * 貸し出し帳の作成とかはそんざいしない
  * 貸し出し帳は、本単位や、ユーザ単位に作成できるかもしれない
